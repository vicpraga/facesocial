<% @user = User.find_by(name: session[:user]) %>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <%= link_to "FaceSocial", root_path, class: "navbar-brand"%>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li class="blanco active"><a href="/"><i class="fa fa-home" aria-hidden="true"></i> Home</a></li>
        <li class="blanco"><a href="/messages/new"><i class="fa fa-plus" aria-hidden="true"></i> New publication</a></li>
      <li class="blanco"><a href="/notifications"><i class="fa fa-comment" aria-hidden="true"></i> Notifications</a></li>
       <li class="blanco"><a href="/friends"><i class="fa fa-users" aria-hidden="true"></i> Friends</a></li>
       <% if @user.admin == true %>
           <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> <i class="fa fa-cogs" aria-hidden="true"></i>
 Manage <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/users">Users</a></li>
            <li><a href="/friends">RelationShips</a></li>
            <li><a href="/likes">Likes</a></li>
            <li><a href="/shareds">Shareds</a></li>
          </ul>
        </li>
       <% end %>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a> 
            <%if session[:user] %>
              <i class="fa fa-user" aria-hidden="true"></i> <%= session[:user] %>
            <% end %>
            <li><a href="/logout" id="logout"><i class="fa fa-sign-out" aria-hidden="true"></i>Logout</a></li>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>
<div class="container">
<div class="panel panel-default">

  <div class="panel-heading"><h1>People</h1></div>
  <table class="table">
  <thead>
    <tr>
      <th style="text-align: center;">User</th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @users.each do |user|
      @request = Friend.where("userA_id = ? or userB_id = ?",@user.id, @user.id).first
      if user.name != @user.name 
          @friend = Friend.new
          @friend.userA_id = @user.id
          @friend.userB_id = user.id
          @friend.estado = false
    %>
        <tr>
          <td style="text-align: center;"><%= user.name %></td>
          <td style="text-align: center;">

          <% if @request!= nil && @request.estado == true %>
              <%= link_to ' Delete friend', @request, method: :delete, data: {confirm: 'Are you sure?'}, class: "fa fa-trash-o btn btn-danger" %>
          
          <%elsif @request!= nil && @request.estado == false %>
           <%=  link_to " Accept", friend_path(@request, :friend => { :estado => true}),
            :method => :put, class: "fa fa-check btn btn-success" %>
  
            <%= link_to ' Cancel', @request, method: :delete, data: {confirm: 'Are you sure?'}, class: "fa fa-times btn btn-danger" %>
          
          <%else%>
           <%=  link_to " Friend request", friends_path(@friend, :friend => { :userA_id => @friend.userA_id, :userB_id => @friend.userB_id, :estado => false}),
            :method => :post, class: "fa fa-user-plus btn btn-success" %>
          <%end%>

          </td>
        </tr>
    <% end %>
  <%end%>
  </tbody>
</table>

</div>
</div>
